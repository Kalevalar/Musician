<Ui xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.blizzard.com/wow/ui/">

	<!-- Keyboard key template -->

	<Button name="MusicianKeyboardKeyTemplate" inherits="UIMenuButtonStretchTemplate" virtual="true">
		<Layers>
			<Layer level="BACKGROUND">
				<Texture parentKey="background" name="$parentBackground">
					<Size x="34" y="20"/>
					<Anchors>
						<Anchor point="CENTER"/>
					</Anchors>
					<Color a="1" r="1" g="1" b="1" />
				</Texture>
			</Layer>
			<Layer level="FOREGROUND">
				<FontString parentKey="subText" name="$parentSubText" inherits="GameFontHighlightSmall">
					<Size x="32" y="32" />
					<Anchors>
						<Anchor point="CENTER" x="0" y="-10" relativePoint="CENTER" relativeTo="$parent" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
		<ButtonText parentKey="Text" name="$parentText">
			<Anchors>
				<Anchor point="CENTER" x="0" y="9"/>
			</Anchors>
		</ButtonText>
		<Scripts>
			<OnLoad inherit="prepend">
				self.background:SetDrawLayer("BACKGROUND", -8)
				self.down = false
			</OnLoad>
			<OnMouseDown inherit="prepend">
				if not(self.down) then
					self.down = true
					local point, relativeTo, relativePoint, xOfs, yOfs = self.subText:GetPoint()
					local x, y = self:GetPushedTextOffset()
					self.subText:SetPoint(point, relativeTo, relativePoint, xOfs + x, yOfs + y)
					Musician.Keyboard.KeyDown(self.keyValue)
				end
			</OnMouseDown>
			<OnMouseUp inherit="prepend">
				if self.down then
					local point, relativeTo, relativePoint, xOfs, yOfs = self.subText:GetPoint()
					local x, y = self:GetPushedTextOffset()
					self.subText:SetPoint(point, relativeTo, relativePoint, xOfs - x, yOfs - y)
					Musician.Keyboard.KeyUp(self.keyValue)
					self.down = false
				end
			</OnMouseUp>
			<OnSizeChanged>
				self.background:SetWidth(w - 7)
				self.background:SetHeight(h - 7)
				self:SetHighlightTexture(nil)
				self.subText:SetWidth(self:GetWidth())
			</OnSizeChanged>
		</Scripts>
		<NormalFont style="GameFontHighlightLarge"/>
		<DisabledFont style="GameFontDisableLarge"/>
		<HighlightFont style="GameFontHighlightLarge"/>
	</Button>

	<!-- Square button template -->

	<Button name="MusicianKeyboardSquareButtonTemplate" inherits="MusicianIconButtonTemplate" virtual="true">
		<Size x="24" y="24" />
	</Button>

	<!-- Layer settings template -->

	<Frame name="MusicianLayerTemplate" virtual="true">
		<Size x="250" y="92" />
		<Layers>
			<Layer level="FOREGROUND">
				<FontString name="$parentLayerName" parentKey="layerName" inherits="GameFontHighlight" justifyh="LEFT">
					<Size x="250" y="32" />
					<Anchors>
						<Anchor point="TOPLEFT" relativePoint="TOPLEFT" relativeTo="$parent" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>

		<Frames>
			<Frame name="$parentInstrument" inherits="MusicianInstrumentDropdownTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" x="-18" relativePoint="BOTTOMLEFT" relativeTo="$parentLayerName" />
				</Anchors>
				<Scripts>
					<OnLoad inherit="prepend">
						UIDropDownMenu_SetWidth(self, 150)
					</OnLoad>
				</Scripts>
			</Frame>

			<Button name="$parentShiftRight" inherits="MusicianKeyboardSquareButtonTemplate" text="R">
				<Anchors>
					<Anchor point="RIGHT" relativePoint="RIGHT" relativeTo="$parent" />
				</Anchors>
			</Button>

			<Button name="$parentShiftReset" inherits="MusicianKeyboardSquareButtonTemplate" text="x">
				<Anchors>
					<Anchor point="RIGHT" relativePoint="LEFT" relativeTo="$parentShiftRight" />
				</Anchors>
			</Button>

			<Button name="$parentShiftLeft" inherits="MusicianKeyboardSquareButtonTemplate" text="L">
				<Anchors>
					<Anchor point="RIGHT" relativePoint="LEFT" relativeTo="$parentShiftReset" />
				</Anchors>
				<ButtonText name="$parentText" parentKey="Text" />
			</Button>

			<Button name="$parentShiftUp" inherits="MusicianKeyboardSquareButtonTemplate" text="U">
				<Anchors>
					<Anchor point="BOTTOM" relativePoint="TOP" relativeTo="$parentShiftReset" />
				</Anchors>
			</Button>

			<Button name="$parentShiftDown" inherits="MusicianKeyboardSquareButtonTemplate" text="D">
				<Anchors>
					<Anchor point="TOP" relativePoint="BOTTOM" relativeTo="$parentShiftReset" />
				</Anchors>
			</Button>

			<CheckButton name="$parentPowerChords" inherits="OptionsSmallCheckButtonTemplate" >
				<Anchors>
					<Anchor point="TOPLEFT" x="16" y="0" relativeTo="$parentInstrument" relativePoint="BOTTOMLEFT" />
				</Anchors>
				<Scripts>
					<OnLoad>
						self.tooltipText = Musician.Msg.POWER_CHORDS
					</OnLoad>
				</Scripts>
				<Size>
					<AbsDimension x="16" y="16"/>
				</Size>
				<HitRectInsets>
					<AbsInset left="0" right="0" top="0" bottom="0"/>
				</HitRectInsets>
			</CheckButton>
		</Frames>

		<Layers>
			<Layer level="FOREGROUND">
				<FontString name="$parentPowerChordsLabel" inherits="MusicianFontIconsNormal" justifyh="LEFT" text="B h">
					<Size x="250" y="32" />
					<Anchors>
						<Anchor point="LEFT" relativePoint="RIGHT" relativeTo="$parentPowerChords" x="4" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
	</Frame>

	<!-- Main frame -->

	<Frame name="MusicianKeyboard" inherits="MusicianDialogTemplate" enableKeyboard="true">
		<Scripts>
			<OnLoad inherit="prepend">
				MusicianKeyboard.showKeyboard = function(visible)
					if visible == nil then
						visible = not(MusicianKeyboardKeys:IsVisible())
					end

					if visible then
						MusicianKeyboard:SetHeight(400)
						MusicianKeyboardKeys:Show()
						MusicianKeyboardToggleKeyboardButton:SetText("u k")
						MusicianKeyboardToggleKeyboardButton.tooltipText = Musician.Msg.HIDE_KEYBOARD
					else
						MusicianKeyboardKeys:Hide()
						MusicianKeyboard:SetHeight(400 - MusicianKeyboardKeys:GetHeight())
						MusicianKeyboardToggleKeyboardButton:SetText("d k")
						MusicianKeyboardToggleKeyboardButton.tooltipText = Musician.Msg.SHOW_KEYBOARD
					end

					Musician_Settings.keyboardVisible = visible
				end
			</OnLoad>
		</Scripts>

		<Size x="790" y="400" />

		<Layers>
			<Layer level="BACKGROUND">
				<FontString name="$parentTitle" inherits="GameFontNormalLarge">
					<Anchors>
						<Anchor point="TOP">
							<Offset>
								<AbsDimension x="0" y="-22"/>
							</Offset>
						</Anchor>
					</Anchors>
				</FontString>

				<FontString name="$parentTitleIcon" parentKey="icon" inherits="MusicianFontHighlightLarge" justifyh="LEFT">
					<Size x="32" y="32" />
					<Anchors>
						<Anchor point="RIGHT" relativePoint="LEFT" relativeTo="$parentTitle" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>

		<Frames>

			<Button name="$parentKeyboardConfigButton" inherits="MusicianIconButtonTemplate" text="G K">
				<Size x="48" y="24" />
				<Anchors>
					<Anchor point="TOPLEFT" relativeTo="$parent" relativePoint="TOPLEFT" y="-20" x="20"  />
				</Anchors>
				<Scripts>
					<OnLoad>
						self.tooltipText = Musician.Msg.CONFIGURE_KEYBOARD
					</OnLoad>
					<OnClick>
						MusicianKeyboard:Hide()
						MusicianKeyboardConfig:Show()
					</OnClick>
				</Scripts>
			</Button>

			<Button name="$parentToggleKeyboardButton" inherits="MusicianIconButtonTemplate" text="d k">
				<Size x="48" y="24" />
				<Anchors>
					<Anchor point="TOPRIGHT" relativeTo="$parent" relativePoint="TOPRIGHT" y="-20" x="-20"  />
				</Anchors>
				<Scripts>
					<OnLoad>
						self.tooltipText = Musician.Msg.HIDE_KEYBOARD
					</OnLoad>
					<OnMouseDown>
						PlaySound(SOUNDKIT.U_CHAT_SCROLL_BUTTON)
					</OnMouseDown>
					<OnClick>
						MusicianKeyboard.showKeyboard()
					</OnClick>
				</Scripts>
			</Button>

			<Button name="$parentLiveModeButton" inherits="MusicianIconTextButtonTemplate">
				<Size x="105" y="24" />
				<Anchors>
					<Anchor point="RIGHT" relativeTo="$parentToggleKeyboardButton" relativePoint="LEFT" />
				</Anchors>
				<OnMouseDown inherits="prepend">
					PlaySound(SOUNDKIT.U_CHAT_SCROLL_BUTTON)
				</OnMouseDown>
			</Button>

			<Frame name="$parentKeys">
				<Anchors>
					<Anchor point="TOP" relativeTo="$parent" relativePoint="TOP" y="-50" />
				</Anchors>
			</Frame>

			<Frame name="$parentControls">
				<Size x="750" y="92" />
				<Anchors>
					<Anchor point="BOTTOM" relativeTo="$parent" relativePoint="BOTTOM" y="10"  />
				</Anchors>

				<Frames>

					<Frame name="$parentMain">
						<Size x="200" y="92" />
						<Anchors>
							<Anchor point="TOP" relativeTo="$parent" relativePoint="TOP" />
						</Anchors>

						<Scripts>
							<OnLoad>
								self.title:SetText(Musician.Msg.KEYBOARD_LAYOUT)
							</OnLoad>
						</Scripts>

						<Layers>
							<Layer level="FOREGROUND">
								<FontString name="$parentTitle" parentKey="title" inherits="GameFontHighlight" justifyh="LEFT">
									<Size x="200" y="32" />
									<Anchors>
										<Anchor point="TOPLEFT" relativePoint="TOPLEFT" relativeTo="$parent" />
									</Anchors>
								</FontString>
							</Layer>
						</Layers>

						<Frames>
							<Frame name="$parentLayoutDropdown" inherits="MusicianDropDownMenuTooltipTemplate">
								<Anchors>
									<Anchor point="TOPLEFT" x="-18" relativePoint="BOTTOMLEFT" relativeTo="$parentTitle" />
								</Anchors>
								<Scripts>
									<OnLoad>
										UIDropDownMenu_SetWidth(self, 130)
									</OnLoad>
								</Scripts>
							</Frame>

							<Frame name="$parentBaseKeyDropdown" inherits="MusicianDropDownMenuTooltipTemplate">
								<Anchors>
									<Anchor point="LEFT" relativePoint="RIGHT" relativeTo="$parentLayoutDropdown" x="-32" />
								</Anchors>
								<Scripts>
									<OnLoad>
										UIDropDownMenu_SetWidth(self, 40)
									</OnLoad>
								</Scripts>
							</Frame>
						</Frames>
					</Frame>

					<Frame name="$parentLower" inherits="MusicianLayerTemplate" virtual="true">
						<Anchors>
							<Anchor point="TOPLEFT" relativePoint="TOPLEFT" relativeTo="$parent" />
						</Anchors>
						<Scripts>
							<OnLoad>
								self.layerName:SetText(Musician.Msg.LAYERS[Musician.KEYBOARD_LAYER.LOWER])
							</OnLoad>
						</Scripts>
					</Frame>

					<Frame name="$parentUpper" inherits="MusicianLayerTemplate" virtual="true">
						<Anchors>
							<Anchor point="TOPRIGHT" relativePoint="TOPRIGHT" relativeTo="$parent" />
						</Anchors>
						<Scripts>
							<OnLoad>
								self.layerName:SetText(Musician.Msg.LAYERS[Musician.KEYBOARD_LAYER.UPPER])
							</OnLoad>
						</Scripts>
					</Frame>

				</Frames>
			</Frame>

		</Frames>
	</Frame>
</Ui>

